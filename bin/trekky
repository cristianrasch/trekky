#!/usr/bin/env ruby
$LOAD_PATH.unshift File.join(Dir.pwd, 'lib')
require 'clap'
require 'trekky/context'
require 'trekky/processor'
require 'trekky/daemon'

source = 'source'
target = 'public'
daemon = false

Clap.run ARGV, 
  "-s" => lambda {|s| source = s },
  "-t" => lambda {|t| target = t },
  "-d" => lambda { daemon = true },
  "-h" => lambda {
    puts "usage: trekky [-h] [-s source] [-t target]"
    exit
  }

context = Trekky::Context.new(source, target)

if daemon 
  Trekky::Daemon.new(context).run
else
  Trekky::Processor.new(context).run
end
